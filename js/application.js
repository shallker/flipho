!function(t){function e(){}_isEmpty=function(t){if("function"==typeof t)return!1;if(null==t||void 0===t)return!0;for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},_getFolder=function(t){var e=t.split("/");return e.pop(),e.join("/")+"/"},e.extensions=["js","coffee"],e.modules={},e.define=function(t,i){e.modules[t]=i},e.initRequire=function(t){return function(i){var r=/^\//,n=/^\.\//,o=/^\.\.\//;return i.replace(n,""),i=r.test(i)?i:n.test(i)?t+i.replace(n,""):o.test(i)?e.lookUp(t,i):t+i,e.require(i)}},e.lookUp=function(t,i){if(""===t)throw"break through root";var r=/^\.\.\//;return t=t.split("/"),t.pop(),t.pop(),t.push(""),t=t.join("/"),i=i.replace(r,""),r.test(i)&&e.lookUp(t,i),t+i},e.require=function(t){t=e.parsePath(t);var i=_getFolder(t),r=e.loadModule(t),n={},o=n.exports={},s=e.initRequire(i);return r.call({},o,s,n),_isEmpty(n.exports)&&(n.exports=void 0),n.exports},e.parsePath=function(t){t=t.split(".");var i=t.pop();return-1===e.extensions.indexOf(i)&&t.push(i),t.join(".")},e.loadModule=function(t){var i=e.modules[t];if(void 0===i)throw"cannot find module "+t;return i},t.define=e.define,t.require=e.initRequire("/")}(this),define("/app",function(t,e,i){!function(){var t,r,n,o,s=function(t,e){return function(){return t.apply(e,arguments)}};o=e("flipho"),r=e("flickr/flickr"),n=e("flickr/flickr-api"),t=function(){function t(){this.onScrollToBottom=s(this.onScrollToBottom,this),this.onGetPhotos=s(this.onGetPhotos,this),this.onScroll=s(this.onScroll,this),i=new o(document.getElementById("flipho")),e=new n("fe13aadb1c4d6582d69b654444da1805"),this.getPhotos(this.onGetPhotos),$(window).scroll(this.onScroll)}var e,i;return i=null,e=null,t.prototype.peopleUsername="patricklikeslight",t.prototype.peopleID="84341102@N00",t.prototype.numPerPage=500,t.prototype.currentPage=1,t.prototype.getPhotos=function(t){return this.getPeoplePublicPhotos(this.peopleID,this.numPerPage,this.currentPage,t)},t.prototype.getPeoplePublicPhotos=function(t,i,n,o){var s;return s=e.people("getPublicPhotos"),s.set("user_id",t),s.set("per_page",i),s.set("page",n),s.request(function(t,e){var i,n,s,h,u,a;if(200!==e.status)throw"api request failed";if(s=JSON.parse(t),"ok"!==s.stat)throw"get public photos failed";for(n=s.photos.photo,h=[],u=0,a=n.length;a>u;u++)i=n[u],h.push(r.buildURL640(i));return o(h)})},t.prototype.getPeopleId=function(t,i){var r;return r=e.people("findByUsername"),r.set("username",t),r.request(function(t,e){var r,n;if(200!==e.status)throw"api request failed";if(r=JSON.parse(t),"ok"!==r.stat)throw"find people failed";return n=r.user,i(usr.id)})},t.prototype.onScroll=function(){return $(window).scrollTop()+$(window).height()>$(document).height()-300?this.onScrollToBottom():void 0},t.prototype.onGetPhotos=function(t){return i.init(t,function(){return i.renderRows(4)})},t.prototype.onScrollToBottom=function(){return i.renderRows(3)},t}(),i.exports=t}.call(this)}),define("/flipho",function(t,e,i){!function(){var t,r,n=function(t,e){return function(){return t.apply(e,arguments)}},o=[].slice;r=e("./row"),t=function(){function t(t){this.el=t,this.log=n(this.log,this),this.onWindowResize=n(this.onWindowResize,this),this.onAddURL=n(this.onAddURL,this),this.onLackOfURL=n(this.onLackOfURL,this),this.onLackOfBuffer=n(this.onLackOfBuffer,this),e=this.log,this.width=$(this.el).width(),$(window).resize(this.onWindowResize),this.bind("lack-of-buffer",this.onLackOfBuffer),this.bind("lack-of-url",this.onLackOfURL)}var e;return e=function(){},t.prototype.urls=[],t.prototype.urlMinNum=100,t.prototype.buffers=[],t.prototype.bufferMinNum=40,t.prototype.imgsPerRow=4,t.prototype.init=function(t,i){return this.urls=t,this.urls.length<this.urlMinNum&&e("init urls "+this.urls.length+" are less than minimum "+this.urlMinNum),this.initBuffer(i)},t.prototype.initBuffer=function(t){var i,r=this;return i=function(){return e("initing"),r.buffers.length===r.bufferMinNum?(t(),r.unbind("add-buffer",i)):void 0},this.bind("add-buffer",i),this.createBuffers(this.bufferMinNum)},t.prototype.addURL=function(t){return this.urls.push(t),this.trigger("add-url")},t.prototype.renderRows=function(t){var e,i,r;for(r=[],e=i=1;t>=1?t>=i:i>=t;e=t>=1?++i:--i)r.push(this.renderRow());return r},t.prototype.renderRow=function(){return this.buffers.length<this.imgsPerRow?e("buffers are not enough"):this.appendRow(this.createRow(this.getBuffers(this.imgsPerRow)))},t.prototype.getBuffers=function(t){var e,i,r;for(e=[],i=r=1;t>=1?t>=r:r>=t;i=t>=1?++r:--r)e.push(this.shiftBuffer());return e},t.prototype.shiftBuffer=function(){return this.trigger("shift-buffer"),this.buffers.length<this.bufferMinNum&&this.trigger("lack-of-buffer"),this.buffers.shift()},t.prototype.shiftURL=function(){return this.trigger("shift-url"),this.urls.length<this.urlMinNum&&this.trigger("lack-of-url"),this.urls.shift()},t.prototype.createBuffers=function(t){var e,i,r;if(!(this.urls.length<t)){for(r=[],e=i=1;t>=1?t>=i:i>=t;e=t>=1?++i:--i)r.push(this.createBuffer());return r}},t.prototype.createBuffer=function(){var t,i=this;return 0===this.urls.length?e("urls are empty"):(t=new Image,t.onload=function(){return i.buffers.push(t),i.trigger("add-buffer")},t.src=this.shiftURL())},t.prototype.onLackOfBuffer=function(){return e("onLackOfBuffer",this.buffers.length),this.createBuffer(2)},t.prototype.onLackOfURL=function(){return e("onLackOfURL",this.urls.length)},t.prototype.onAddURL=function(){},t.prototype.onWindowResize=function(){return this.width=$(this.el).width()},t.prototype.log=function(){var t;if(this.debug)return t=[].slice.call(arguments),t.unshift("Flipho:"),console.log.apply(console,t)},t.prototype.appendRow=function(t){return this.el.appendChild(t.el)},t.prototype.createRow=function(t){return new r(t,$(this.el).width())},t.prototype.bind=function(t,e){var i,r,n,o,s;for(r=t.split(" "),i=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={}),o=0,s=r.length;s>o;o++)n=r[o],i[n]||(i[n]=[]),i[n].push(e);return this},t.prototype.one=function(t,e){return this.bind(t,function(){return this.unbind(t,arguments.callee),e.apply(this,arguments)})},t.prototype.trigger=function(){var t,e,i,r,n,s,h;if(t=1<=arguments.length?o.call(arguments,0):[],i=t.shift(),r=this.hasOwnProperty("_callbacks")&&(null!=(h=this._callbacks)?h[i]:void 0)){for(n=0,s=r.length;s>n&&(e=r[n],e.apply(this,t)!==!1);n++);return!0}},t.prototype.unbind=function(t,e){var i,r,n,o,s,h;if(!t)return this._callbacks={},this;if(n=null!=(h=this._callbacks)?h[t]:void 0,!n)return this;if(!e)return delete this._callbacks[t],this;for(r=o=0,s=n.length;s>o;r=++o)if(i=n[r],i===e){n=n.slice(),n.splice(r,1),this._callbacks[t]=n;break}return this},t}(),i.exports=t}.call(this)}),define("/row",function(t,e,i){!function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(t,i){this.imgs=t,this.width=i,this.onWindowResize=e(this.onWindowResize,this),this.onClickPhoto=e(this.onClickPhoto,this),this.photos=[],this.detectScrollBar(),this.detectWindowResize(),this.el=document.createElement("div"),this.el.className=this.className,this.appendPhotos(this.imgs),$(this.el).on("click",".photo",this.onClickPhoto)}var i;return t.prototype.gutter=11,t.prototype.className="row",i=function(){return $(document).height()>$(window).height()},t.prototype.detectWindowResize=function(){return $(window).resize(this.onWindowResize)},t.prototype.detectScrollBar=function(){var t=this;if(!i())return this.detecting=setInterval(function(){return i()?(t.onWindowResize(),clearInterval(t.detecting)):void 0},10)},t.prototype.onClickPhoto=function(t){return console.log(t),this.appendEnlarge(this.createEnlarge(t.target))},t.prototype.createEnlarge=function(t){var e,i;return i=document.createElement("img"),i.src=t.getAttribute("data-src"),e=document.createElement("div"),e.className="enlarge",e.setAttribute("data-src",t.getAttribute("data-src")),e.appendChild(i),e},t.prototype.appendEnlarge=function(t){return window.enlarge&&$(window.enlarge).remove(),window.enlarge=$(t).insertAfter($(this.el))},t.prototype.appendPhotos=function(t){var e,i,r,n,o,s,h;for(e=this.calculateHeight(this.width),h=[],o=0,s=t.length;s>o;o++)i=t[o],n=i.width*e/i.height,r=document.createElement("div"),r.className="photo",r.style.height=e+"px",r.style.width=n+"px",r.style.backgroundImage="url("+i.src+")",r.style.backgroundSize="cover",r.setAttribute("data-src",i.src),r.setAttribute("data-width",n),r.setAttribute("data-height",e),r.setAttribute("data-natural-width",i.naturalWidth),r.setAttribute("data-natural-height",i.naturalHeight),this.el.appendChild(r),h.push(this.photos.push(r));return h},t.prototype.appendImgs=function(t){var e,i,r,n,o;for(e=this.calculateHeight(t,this.width,this.gutter),o=[],r=0,n=t.length;n>r;r++)i=t[r],i.height=e,o.push(this.el.appendChild(i));return o},t.prototype.resize=function(t){return this.width=t,this.resizePhotos(this.calculatePhotosHeight())},t.prototype.resizeImgs=function(t){var e,i,r,n,o;for(n=this.imgs,o=[],i=0,r=n.length;r>i;i++)e=n[i],o.push(e.height=t);return o},t.prototype.resizePhotos=function(t){var e,i,r,n,o,s;for(o=this.photos,s=[],r=0,n=o.length;n>r;r++)i=o[r],e=i.offsetWidth*t/i.offsetHeight,i.style.height=t+"px",s.push(i.style.width=e+"px");return s},t.prototype.calculateHeight=function(t){var e;return e=t-(this.imgs.length+1)*this.gutter,this.mathUnifiedHeight(this.imgs,e)},t.prototype.mathUnifiedHeight=function(t,e){var i,r,n,o,s,h;for(t=t.slice(0),o=0,i=0,n=t.shift(),i+=n.width,s=0,h=t.length;h>s;s++)r=t[s],i+=r.width*n.height/r.height;return o=e/i,n.height*o},t.prototype.onWindowResize=function(){return this.resize($(this.el).width())},t.prototype.calculatePhotosHeight=function(){var t,e,i,r,n,o,s,h;for(r=this.photos.slice(0),o=this.width-(r.length+1)*this.gutter,n=0,t=0,i=r.shift(),t+=i.clientWidth,s=0,h=r.length;h>s;s++)e=r[s],t+=e.clientWidth*i.clientHeight/e.clientHeight;return n=o/t,i.clientHeight*n},t}(),i.exports=t}.call(this)}),define("/flickr/flickr-api",function(t,e,i){var r=e("../lib/xhr"),n=e("../lib/paramer"),o=function(){function t(){}function e(e){this.key=e,this.log=function(){if(this.debug){var t=[].slice.call(arguments);t.unshift("FlickrAPI"),console.log.apply(console,t)}},t=this.log.bind(this)}return e.prototype=function(){function e(e){this.url="http://api.flickr.com/services/rest/?",this.method="GET",this.params=e,this.params.format="json",this.params.nojsoncallback=1,this.set=function(t,e){this.params[t]=e},this.request=function(e){e=e||function(){};var i=new n;for(name in this.params)i.set(name,this.params[name]);var o=i.build(),s=new r;s.set("url",this.url+o),s.set("method",this.method),s.request(function(i,r){t(this.params.method,i),e(i,r)}.bind(this))}}return this.people=function(t){return"uploadPhoto"==t?this.peopleUploadPhoto():this.api("flickr.people."+t)},this.peopleUploadPhoto=function(){var t;return t=this.api("flickr.people.uploadPhoto"),t.method="POST",t},this.api=function(t){var i={};return i.method=t,i.api_key=this.key,new e(i)},this}.call({}),e}();i.exports=o}),define("/flickr/flickr",function(t,e,i){function r(){}r.buildURL1024=function(t){return r.buildURL(t)+"_b.jpg"},r.buildURL800=function(t){return r.buildURL(t)+"_c.jpg"},r.buildURL640=function(t){return r.buildURL(t)+"_z.jpg"},r.buildURL=function(t){return"http://farm"+t.farm+".staticflickr.com/"+t.server+"/"+t.id+"_"+t.secret},i.exports=r}),define("/lib/paramer",function(t,e,i){var r=function(){this.args={},this.set=function(t,e){return this.args[t]=e,this},this.toArray=function(){var t=[];for(var e in this.args)t.push(e+"="+this.args[e]);return t},this.build=function(){var t=this.toArray().join("&");return this.args={},t},this.parse=function(t){var e=t.split("&"),i={};for(var r in e){var n=e[r].split("=");i[n.shift()]=n.shift()}return i}};i.exports=r}),define("/lib/xhr",function(t,e,i){var r;r=function(){this.sets={},this.sets.data="",this.sets.headers={},this.sets.async=!0,this.onComplete=function(){},this.set=function(t,e){return"method"===t?this.setMethod(e):"data"===t?this.setData(e):(this.sets[t]=e,void 0)},this.setMethod=function(t){var e=["POST","PUT","GET","DELETE","OPTIONS","HEAD"];if(-1===e.indexOf(t))throw"Method "+t+" is not allowed";this.sets.method=t},this.setHeader=function(t,e){this.sets.headers[t]=e},this.setData=function(t){"object"==typeof t&&(t=JSON.stringify(t)),this.sets.data=t};var t=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP");throw"Cannot creat an XMLHTTP instance"};this.request=function(e){this.onComplete=e||this.onComplete;var i,r=this;i=t(),i.onreadystatechange=function(){4===i.readyState&&r.onComplete.call(this,i.responseText,i)},i.open(this.sets.method,this.sets.url,this.sets.async);for(var n in this.sets.headers)i.setRequestHeader(n,this.sets.headers[n]);return i.send(this.sets.data),i}},i.exports=r});